import{r as e,a as m,j as c}from"./app-BGWLi5zn.js";import{I,P as j}from"./PairingModal-quV0mIbm.js";function E(){const[s,x]=e.useState(""),[p,y]=e.useState(""),[b,h]=e.useState(""),[a,l]=e.useState(!1),[o,f]=e.useState(30),[v,g]=e.useState(!1),[w,r]=e.useState({type:"",text:""}),[d,u]=e.useState("pending"),S=async n=>{n.preventDefault(),g(!0),r({type:"",text:""}),u("pending");try{const t=await m.post("/evolution/public/create",{instanceName:s,number:p});if(t.data.error)r({type:"error",text:t.data.message});else{const i=t.data.response?.qrcode?.pairingCode||null;i?(h(i),l(!0),f(30),r({type:"success",text:"Instancia creada correctamente."})):r({type:"error",text:"No se pudo generar el código de emparejamiento."})}}catch(t){const i=t.response?.data?.message||"Error al crear la instancia.";r({type:"error",text:i})}finally{g(!1)}};return e.useEffect(()=>{if(!a)return;const n=setInterval(async()=>{try{(await m.get(`/evolution/public/status/${s}`)).data.connected&&(u("connected"),clearInterval(n),setTimeout(()=>{l(!1),r({type:"success",text:"Instancia conectada correctamente Jaime"})},2e3))}catch{}},3e3);return()=>clearInterval(n)},[a,s]),e.useEffect(()=>{if(!a||o<=0)return;const n=setInterval(()=>f(t=>t-1),1e3);return()=>clearInterval(n)},[a,o]),e.useEffect(()=>{o===0&&a&&d!=="connected"&&(u("failed"),m.delete(`/evolution/public/destroy/${s}`).then(()=>r({type:"error",text:"Instancia eliminada por timeout."})).finally(()=>setTimeout(()=>l(!1),3e3)))},[o,a,d,s]),c.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-900 px-4",children:[c.jsxs("div",{className:`relative w-full max-w-md p-8 bg-gradient-to-br from-gray-800 via-black to-gray-900\r
                      rounded-r-3xl border-l-4 border-r-4 border-green-500 shadow-2xl hover:shadow-green-600 transition-shadow duration-300`,children:[c.jsx("h2",{className:`text-2xl text-center mb-6 bg-clip-text text-transparent \r
                       bg-gradient-to-r from-green-400 to-green-900 tracking-wide`,children:"Crear instancia pública (sin BD)"}),c.jsx(I,{instanceName:s,setInstanceName:x,number:p,setNumber:y,handleSubmit:S,processing:v,message:w})]}),c.jsx(j,{showModal:a,pairingCode:b,countdown:o,connectionState:d})]})}export{E as default};
