import{r as n,j as e,a as w}from"./app-Cz4JC4jO.js";function E({instanceName:o,setInstanceName:g,number:d,setNumber:p,handleSubmit:b,processing:i,message:c}){const[r,m]=n.useState({instanceName:"",number:""}),[u,y]=n.useState(!1),h=t=>t.trim()?/\s/.test(t)?"No se permiten espacios.":t.length<3?"Debe tener al menos 3 caracteres.":t.length>20?"No puede superar los 20 caracteres.":/^[a-zA-Z0-9_-]+$/.test(t)?"":"Solo letras, números, guiones y guiones bajos.":"El nombre no puede estar vacío.",N=t=>t?/^[0-9]+$/.test(t)?t.length<8?"El número es demasiado corto.":t.length>15?"El número es demasiado largo.":"":"Solo se permiten números.":"El número es obligatorio.",x=t=>{t.preventDefault(),y(!0);const s=h(o),a=N(d);m({instanceName:s,number:a}),!s&&!a&&b(t)},j=t=>{const s=t.target.value.replace(/\D/g,"");p(s)},l=t=>{const s=t.target.value.replace(/\s/g,"");g(s),u&&m(a=>({...a,instanceName:h(s)}))};return e.jsxs("form",{onSubmit:x,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-1",children:"Nombre de instancia"}),e.jsx("input",{type:"text",value:o,onChange:l,className:`w-full border-l-4 rounded-r-xl p-2 outline-none transition-all
            ${u&&r.instanceName?"border-red-500 focus:ring-red-500":"border-green-500 focus:ring-green-400"} bg-gray-800 text-white placeholder-gray-400`,placeholder:"Ej: MiEmpresaBot"}),u&&r.instanceName&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.instanceName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-200 mb-1",children:"Número de WhatsApp"}),e.jsx("input",{type:"text",inputMode:"numeric",pattern:"[0-9]*",value:d,onChange:j,className:`w-full border-l-4 rounded-r-xl p-2 outline-none transition-all
            ${u&&r.number?"border-red-500 focus:ring-red-500":"border-green-500 focus:ring-green-400"} bg-gray-800 text-white placeholder-gray-400`,placeholder:"Ej: 5491123456789"}),u&&r.number&&e.jsx("p",{className:"text-red-500 text-sm mt-1",children:r.number})]}),e.jsx("button",{type:"submit",disabled:i,className:`w-full text-white py-2 rounded-lg transition-all font-semibold
          ${i?"bg-gray-600 cursor-not-allowed":"bg-green-600 hover:bg-green-500"}`,children:i?"Creando...":"Crear instancia"}),c.text&&e.jsx("div",{className:`mt-4 text-center font-semibold ${c.type==="error"?"text-red-500":"text-green-400"}`,children:c.text})]})}function S({showModal:o,setShowModal:g,pairingCode:d,countdown:p,verificarConexion:b,modalMessage:i}){return o?e.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:e.jsxs("div",{className:"bg-gray-900 text-white p-6 rounded-l-3xl shadow-2xl w-80 text-center relative border-l-4 border-green-500",children:[e.jsx("button",{onClick:()=>g(!1),className:"absolute top-2 right-3 text-gray-400 hover:text-white transition-colors",children:"✕"}),e.jsx("h3",{className:"text-xl font-light mb-3 text-green-400 tracking-wide",children:"Pairing Code"}),i.text&&e.jsx("p",{className:`mb-4 text-sm ${i.type==="error"?"text-red-500":"text-green-400"}`,children:i.text}),d&&e.jsxs(e.Fragment,{children:[e.jsx("p",{className:"text-2xl font-semibold text-blue-400 mb-2",children:d}),e.jsxs("p",{className:"text-gray-300 mb-4 text-sm",children:["Tienes ",e.jsxs("span",{className:"font-bold text-red-500",children:[p,"s"]})," para configurarlo."]})]}),e.jsx("button",{onClick:()=>{b()},className:"bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded-lg font-medium transition-all mt-2 w-full",children:"Verificar conexión"})]})}):null}function k(){const[o,g]=n.useState(""),[d,p]=n.useState(""),[b,i]=n.useState(""),[c,r]=n.useState(!1),[m,u]=n.useState(30),[y,h]=n.useState(!1),[N,x]=n.useState({type:"",text:""}),[j,l]=n.useState({type:"",text:""}),t=async a=>{a.preventDefault(),h(!0),x({type:"",text:""}),l({type:"",text:""});try{const v=(await w.post("/evolution/create",{instanceName:o,number:d})).data.response,C=v?.qrcode?.pairingCode||v?.instance?.qrcode?.pairingCode||v?.pairingCode||null;C?(i(C),r(!0),u(30),x({type:"success",text:"Instancia creada ingresar codigo de acceso."}),l({type:"success",text:"Instancia creada. Copia el código."})):(x({type:"error",text:"Instancia creada, pero no se devolvió un código de emparejamiento."}),l({type:"error",text:"No se devolvió un código de emparejamiento."}),r(!0))}catch(f){console.error("Error al crear instancia:",f),x({type:"error",text:"Error al crear la instancia. Verifica los datos o la conexión."}),l({type:"error",text:"Error al crear la instancia. Revisa tus datos o la conexión."}),r(!0)}finally{h(!1)}},s=async()=>{try{(await w.get(`/evolution/status/${o}`)).data.connected?l({type:"success",text:" Instancia conectada correctamente."}):(await w.delete(`/evolution/destroy/${o}`),l({type:"error",text:" No se pudo conectar con la Instancia."}))}catch{l({type:"error",text:"Asegurese de haber llenado todos los campos."})}};return n.useEffect(()=>{if(m>0){const a=setInterval(()=>u(f=>f-1),1e3);return()=>clearInterval(a)}else m===0&&c&&s()},[c,m]),e.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-900 px-4",children:[e.jsxs("div",{className:`relative w-full max-w-md p-8 bg-gradient-to-br from-gray-800 via-black to-gray-900\r
                  rounded-r-3xl border-l-4 border-r-4 border-green-500 shadow-2xl hover:shadow-green-600 transition-shadow duration-300`,children:[e.jsx("h2",{className:`text-2xl text-center mb-6 bg-clip-text text-transparent \r
                     bg-gradient-to-r from-green-400 to-green-900 tracking-wide`,children:"Crear Instancia"}),e.jsx(E,{instanceName:o,setInstanceName:g,number:d,setNumber:p,handleSubmit:t,processing:y,message:N}),e.jsx("div",{className:"mt-4 text-center",children:e.jsx("button",{onClick:()=>r(!c),className:"text-green-400 hover:text-green-300 font-medium",children:c?"":"Ver último Pairing Code"})})]}),e.jsx(S,{showModal:c,setShowModal:r,pairingCode:b,countdown:m,verificarConexion:s,modalMessage:j})]})}export{k as default};
