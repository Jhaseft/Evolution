import{r as e,a as m,j as i}from"./app-BXG5rwVn.js";import{d as x,I as j,P as E}from"./PairingModal-x2CEucRH.js";function M(){const[r,h]=e.useState(""),[p,v]=e.useState(""),[y,b]=e.useState(""),[a,l]=e.useState(!1),[o,f]=e.useState(30),[w,g]=e.useState(!1),[I,s]=e.useState({type:"",text:""}),[d,u]=e.useState("pending"),S=async n=>{n.preventDefault(),g(!0),s({type:"",text:""}),u("pending");try{const t=await m.post("/evolution/create",{instanceName:r,number:p});if(t.data.error)s({type:"error",text:t.data.message});else{const c=t.data.response?.qrcode?.pairingCode||null;c?(b(c),l(!0),f(30),s({type:"success",text:"Instancia creada correctamente."})):s({type:"error",text:"No se pudo generar el cÃ³digo de emparejamiento."})}}catch(t){const c=t.response?.data?.message||"Error al crear la instancia.";s({type:"error",text:c})}finally{g(!1)}};return e.useEffect(()=>{if(!a)return;const n=setInterval(async()=>{try{(await m.get(`/evolution/status/${r}`)).data.connected&&(u("connected"),clearInterval(n),setTimeout(()=>{l(!1),x.Inertia.visit("/dashboard")},2e3))}catch{}},3e3);return()=>clearInterval(n)},[a,r]),e.useEffect(()=>{if(!a||o<=0)return;const n=setInterval(()=>f(t=>t-1),1e3);return()=>clearInterval(n)},[a,o]),e.useEffect(()=>{o===0&&a&&d!=="connected"&&(u("failed"),m.delete(`/evolution/destroy/${r}`).then(()=>s({type:"error",text:"Instancia eliminada por timeout."})).finally(()=>setTimeout(()=>l(!1),3e3)),x.Inertia.visit("/dashboard"))},[o,a,d,r]),i.jsxs("div",{className:"flex flex-col items-center justify-center min-h-screen bg-gray-900 px-4",children:[i.jsxs("div",{className:`relative w-full max-w-md p-8 bg-gradient-to-br from-gray-800 via-black to-gray-900\r
                      rounded-r-3xl border-l-4 border-r-4 border-green-500 shadow-2xl hover:shadow-green-600 transition-shadow duration-300`,children:[i.jsx("h2",{className:`text-2xl text-center mb-6 bg-clip-text text-transparent \r
                       bg-gradient-to-r from-green-400 to-green-900 tracking-wide`,children:"Enlazar WhatsApp con Evolution"}),i.jsx(j,{instanceName:r,setInstanceName:h,number:p,setNumber:v,handleSubmit:S,processing:w,message:I})]}),i.jsx(E,{showModal:a,pairingCode:y,countdown:o,connectionState:d})]})}export{M as default};
